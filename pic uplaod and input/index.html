<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.min.js"></script>
    <meta charset="utf-8">

    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <meta charset="utf-8">
    <title>JS Bin</title>
</head>

<body ng-app="myApp">
    <input type="text" input-validation="onlyNumbers" ng-model="data1" />
    <input type="text" input-validation="withTwoDigits" ng-model="data2" />
    <input upload-file ng-model="picData" picId="div1">
    <img id="div1" style="width:100px;height:100px"></img>
</body>

</html>
<script>
    /*
     * Directive for clearing the Inputfield Data.
     */
    angVal = angular.module("angular-validation", []);
    /* Directive for Validations.
     */
    angular.module("myApp", ["angular-validation"]);
    angVal.factory("postImage", function ($http) {
        var factObj = {};
        factObj.call = function (imgBase64Data, url, success, error) {

            var angularPromise = $http.post(imgBase64Data, url);
            angularPromise.then(function (data) {
                success(data);

            }, function (reason) {
                error(reason);
            });
        };
        return factObj;


    });
    angVal.directive("uploadFile", function (postImage) {
        return {
            restrict: 'A',

            link: function (scope, elem, attrs) {
                scope.uploadImage = function () {
                    var file = event.currentTarget.files[0];
                    mimeType = file.type;
                    console.log(mimeType);
                    if (mimeType.substr(0, 5) == 'image') {
                        var contentAsBase64EncodedString;
                        var FR = new FileReader();
                        //this is callback for readAsDataURL(file)
                        FR.onload = function (encodedFile) {
                            scope.src = encodedFile.target.result;
                            // src1 = scope.src.split("base64,");
                            // This is the base64 encoded string of that media file which you will be interested to store in the database(post to the server
                            //contentAsBase64EncodedString = src1[1];
                            console.log(scope.src);


                        };

                        FR.onloadend = function (encodedFile) {
                            if (attrs.url != undefined || attrs.success != undefined || attrs.fail != undefined)
                                postImage.call(encodedFile.target.result, attrs.url, attrs.success, attrs.fail);
                            else if (attrs.picid != undefined)

                                $("#" + attrs.picid).attr("src", scope.src);

                        };
                        g = FR.readAsDataURL(file);
                    } else {
                        angular.element('input[type=file]').val('');
                    }

                };
                attrs.$set('onchange', 'angular.element(this).scope().uploadImage()');
                attrs.$set('type', 'file');
                attrs.$set('accept', "image/*");

            }
        };


    });

    angVal.directive('inputValidation', [
          function () {
            return {
                restrict: 'A',
                require: 'ngModel',

                link: function (scope, elem, attrs, ctrl) {

                    var pattern, flag = 0,
                        data = 0;
                    //to stop the autocompletion in input type="text"
                    attrs.$set('autocapitalize', 'off');
                    attrs.$set('autocorrect', 'off');
                    attrs.$set('autocomplete', 'off');
                    attrs.$set('spellcheck', 'false');

                    elem.on('blur', function (e) {
                        switch (attrs.inputValidation) {
                        case "withTwoDigits":
                            modifyValues(e); //function to verify the two digits validation on blur and modify values 
                            break;
                        default:
                            break;
                        }

                        function modifyValues() {

                            var a = angular.element(e.currentTarget).val();

                            if (a == "0.00" || a == '.00') {
                                angular.element(e.currentTarget).val(0);
                            }

                            if (a[0] == '.' && typeof (a[1]) == 'undefined') {
                                angular.element(e.currentTarget).val(0);
                            } else if (a[0] == '.' && typeof (a[1]) != 'undefined') {
                                angular.element(e.currentTarget).val(0 + a);
                            }

                            if (((a == "." || a % 1 === 0) && (parseFloat(a) === 0 || a == ".")) && attrs.nosdec === "true") {
                                0
                                angular.element(e.currentTarget).val('');
                            } else {

                                if (attrs.nosdec === "true" && parseFloat(a) !== 0 && a.trim() !== '' && a.trim() != '.') {

                                    angular.element(e.currentTarget).val(parseFloat(a));
                                }
                            }

                            if (a[a.length - 1] == "." && a[0] != '.') {
                                angular.element(e.currentTarget).val(parseFloat(a).toFixed(2));
                            }

                        }

                    });
                    //on focus setting the prev value of filed to data variable.
                    elem.on('focusin', function (e) {
                        if (flag == 0) {
                            flag = 1;

                            data = angular.element(e.currentTarget).val();

                        }
                    });
                    //on focus out set flag to 0
                    elem.on('focusout', function () {
                        flag = 0;
                    });

                    //on change of input this event will be triggered
                    elem.on('input', function (e) {
                        //you can add your validation pattern and make them applicable
                        switch (attrs.inputValidation) {
                        case "restrictSpaces":
                            pattern = /^[a-zA-Z0-9]*$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 50 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;
                        case "pwdCheck":
                            pattern = /^[a-zA-Z0-9!@#%$^&*()]*$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 20 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;
                        case "onlyNumbers":
                            pattern = /^[0-9]*$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 20 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;
                        case "withTwoDigits":
                            pattern = /^[0-9]*(\.{1})?([0-9]{1,2})?$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 20 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;
                        case "search":
                            pattern = /^[a-zA-Z0-9&%-,*'. ()]*$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 50 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;

                        default:
                            pattern = /^[^<>{}]*$/;
                            maxLength = (typeof (attrs.mxlength) == "undefined") ? 100 : attrs.mxlength;
                            minLength = (typeof (attrs.mnlength) == "undefined") ? 0 : attrs.mnlength;
                            break;
                        };

                        if (!pattern.test(angular.element(e.currentTarget).val()) || angular.element(e.currentTarget).val().length > maxLength) {

                            angular.element(e.currentTarget).val(data);
                            ctrl.$setViewValue(data);
                            ctrl.$render();
                        } else {
                            data = angular.element(e.currentTarget).val();
                        }

                    });
                }
            };
}]);
</script>